# 重构计划：前端本地存储改服务端存储

## 1. 前端服务层重构

### 1.1 基金持仓服务重构
- 修改 `portfolioService.ts`：将本地数据库操作改为调用后端 API
- 实现 API 调用函数，对应后端的 getUserData、saveUserData、updateUserData 接口
- 保持服务接口不变，确保上层组件无需修改

### 1.2 股票持仓服务重构
- 修改 `stockHoldingService.ts`：将本地数据库操作改为调用后端 API
- 实现对应的 API 调用函数
- 保持服务接口不变

### 1.3 分组服务重构
- 修改 `groupService.ts`：将本地数据库操作改为调用后端 API
- 实现对应的 API 调用函数
- 保持服务接口不变

### 1.4 API 服务层增强
- 完善 `services/api/` 目录下的 API 调用函数
- 添加错误处理和请求状态管理
- 确保所有数据操作都有对应的 API 调用

## 2. 前端状态管理调整

### 2.1 存储管理调整
- 修改 `store/` 目录下的状态管理逻辑
- 确保数据从服务端获取并实时更新
- 添加数据加载状态和错误处理

### 2.2 同步机制优化
- 利用现有的 `usePositionSync` 钩子
- 确保数据在编辑后及时同步到服务端
- 添加数据冲突处理机制

## 3. 后端 API 增强

### 3.1 API 路由完善
- 检查并完善 `backend/routes/data.js` 中的路由
- 确保所有必要的操作都有对应的 API 端点
- 添加适当的请求验证

### 3.2 数据模型优化
- 确保 `UserData` 模型能够处理所有前端需要的数据结构
- 优化数据存储和查询性能
- 添加必要的索引

## 4. 测试和验证

### 4.1 功能测试
- 测试所有数据操作功能：添加、编辑、删除持仓
- 测试分组管理功能
- 测试数据同步功能

### 4.2 性能测试
- 测试数据加载速度
- 测试多用户并发操作
- 测试网络异常情况下的处理

### 4.3 兼容性测试
- 确保重构后的代码与现有组件兼容
- 确保用户体验不受影响

## 5. 部署和迁移

### 5.1 数据迁移
- 实现从前端本地存储到服务端存储的数据迁移功能
- 确保用户现有数据不会丢失

### 5.2 部署计划
- 后端部署：确保 MongoDB 服务正常运行
- 前端部署：确保 API 调用配置正确
- 监控和回滚方案

## 重构原则

1. **保持接口稳定**：尽量保持前端服务接口不变，减少上层组件的修改
2. **渐进式重构**：可以先实现核心功能，再逐步完善
3. **错误处理**：添加完善的错误处理机制，确保用户体验
4. **性能优化**：合理使用缓存和批量操作，减少 API 调用次数
5. **数据安全**：确保所有数据操作都经过身份验证和授权

## 预期成果

- 所有数据存储在服务端 MongoDB 中
- 前端通过 API 调用进行数据操作
- 数据同步实时可靠
- 用户体验与之前保持一致或更好
- 系统可扩展性和可维护性提升